function _asyncToGenerator(a){return function(){var b=a.apply(this,arguments);return new Promise(function(a,c){function d(e,f){try{var g=b[e](f),h=g.value}catch(a){return void c(a)}return g.done?void a(h):Promise.resolve(h).then(function(a){d('next',a)},function(a){d('throw',a)})}return d('next')})}}const qs=require('querystring'),{createJobUrl,sleep,get,post}=require('./helpers');class Jenkins{constructor(a,b,c,d={}){this.token=b,this.baseUrl=`http://${a}:${b}@${c}`,this.urlParams={token:b},this.headers=Object.assign({},{Authorization:this.urlParams.token},d),this.crumb=null}info(){var a=this;return _asyncToGenerator(function*(){return get(...(yield a._getRequest('/api/json')))})()}getJobInfo(a){var b=this;return _asyncToGenerator(function*(){return get(...(yield b._getRequest(a,!0)))})()}getBuildInfo(a,b){var c=this;return _asyncToGenerator(function*(){return get(...(yield c._getRequest(a,!0,b)))})()}build(a,b={}){var c=this;return _asyncToGenerator(function*(){const[d,e]=yield c._getRequest(a,!0,'/buildWithParameters');return post(d,b,e)})()}progressiveText(a,b,c=100){var d=this;return _asyncToGenerator(function*(){for(let e=!0,f=0;e;){const[g]=yield d._getRequest(a,!0,`/${b}/logText/progressiveText`),h=yield get(`${g}&start=${f}`,d.headers,!0),i=h.data;e=h.headers['x-more-data'],f=h.headers['x-text-size'],i&&console.log(i),yield sleep(c)}})()}_getCrumb(){var a=this;return _asyncToGenerator(function*(){const b=`${a.baseUrl}/crumbIssuer/api/json`,c=yield get(b);return a.crumb=c,c})()}_getRequest(a,b=!1,c=''){var d=this;return _asyncToGenerator(function*(){a.startsWith('/')||(a=`/${a}`),c.length&&!c.startsWith('/')&&(c=`/${c}`);const e=`${d.baseUrl}${b?`${createJobUrl(a)}${c}/api/json`:a}`,f=d.crumb||(yield d._getCrumb()),g=Object.assign({},d.headers,{[f.crumbRequestField]:f.crumb});return[`${e}?${qs.stringify(d.urlParams)}`,{headers:g}]})()}toString(){return`<Jenkins ${this.token}>`}}module.exports=Jenkins;
